---
import { Picture } from "astro:assets";
import type { ImageMetadata } from "astro";

interface Props {
	src: string | ImageMetadata;
	alt: string;
	title?: string;
}

const { src, alt, title } = Astro.props;

// If `src` is an object (ImageMetadata), use it directly; otherwise, fallback to the string
const imageSrc = typeof src === "object" ? src : undefined;
const fallbackSrc = typeof src === "string" ? src : undefined;
---

<figure class="post-image grid">
	{
		imageSrc ? (
			<Picture
				src={imageSrc}
				alt={alt}
				formats={["avif", "webp"]}
				widths={[640, 960, 1280, 1920]}
				sizes="(max-width: 96rem) 100vw, 1328px"
			/>
		) : (
			<img src={fallbackSrc} alt={alt} />
		)
	}
	{title && <figcaption>{title}</figcaption>}
</figure>
